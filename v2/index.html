<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font-family: sans-serif;
}

svg {
  position: absolute;
  top: 0;
}

#horizon-controls {
  position: absolute;
  width: 940px;
  padding: 10px;
  z-index: 1;
}

#horizon-bands {
  float: right;
}

</style>
<div id="horizon-controls">
  <span id="horizon-bands">
    <button class="horizon">Horizon</button>
    <button class="area">Area</button>
  </span>
</div>
<div id="horizon-chart"></div>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="horizon.js?0.0.1"></script>
<script>

var width = 960,
    height = 150;

var chart = d3.horizon()
    .width(width)
    .height(height)
    .bands(6)
    .mode("mirror")
    .interpolate("basis");

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json("data-all.json", function(error, data) {
  if (error) throw error;

  var nestedData = d3.nest()
      .key(function(d) { return d.category })
      .entries(data);

    console.log('nestedData', nestedData);
    console.log('data', data);
})

d3.json("data.json", function(error, data) {
  if (error) throw error;
  // Offset so that positive is above-average and negative is below-average.
 // var mean = data.rate.reduce(function(p, v) { return p + v; }, 0) / data.rate.length;

  // Transpose column values to rows. 
  data = data.value.map(function(value, i) {
    return [data.year[i], value];
  });

  console.log(data);

  // Render the chart.
  svg.data([data]).call(chart);


  // Enable bands buttons. TO DO: Animate area to horizon chart better
  d3.selectAll("#horizon-bands button").on("click", function() {
    console.log('this = ', this.className);
    (this.className === 'area') ?  n = 1 : n = 6;
    console.log(this.className, n);
    svg.call(chart.duration(1000).bands(n).height(height));
  });
});

</script>

<!DOCTYPE html>
<meta charset="utf-8">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>WIRED | Data Leaks</title>

    <script type="text/javascript" src="http://www.aviz.fr/wiki/pub/skins/aviz-blix/javascript/jquery.js"></script>

</head>

<body>
    <div id="container">
        <div id="content-wrapper">
            <div id="content-container">
                <div id="content">
                    <!--PageTitleGroupFmt-->
                    <div class="breadcrumb">
                        <!--/PageTitleGroupFmt-->
                        <!--PageTitleFmt-->
                    </div>
                    <!--/PageTitleFmt-->
                    <!--PageText-->
                    <div id='wikitext'>
                        <p>
                            <script type="text/javascript" src="http://www.aviz.fr/wiki/pub/skins/aviz-blix/javascript/d3.v2.min.js"></script>
                            <script type="text/javascript" src="http://www.aviz.fr/wiki/uploads/Research/horizon.js"></script>
                        </p>
                        <div id="horizon-controls">
                            <span id="horizon-bands">
   				 <button class="horizon">Horizon</button>
   		 <button class="area">Area</button>
  </span>
                        </div>
                        <div>
                            <div id="horizon-chart" style="margin-top:50px">
                                <div id="chartsDiv"></div>
                            </div>
                        </div>
                        <script>
                        var width = 960,
                            height = 150;

                        var nbChartsStart = 5;
                        var marginCharts = 2;

                        createCharts(nbChartsStart);


                        function createCharts(nbCharts) {

                            d3.select("#chartsDiv").remove();
                            d3.select("#horizon-chart").append("div").attr("id", "chartsDiv");


                            var charts = Array();

                            var svgs = Array();

                            for (var n = 0; n < nbCharts; n++) {
                                var chart = d3.horizon()
                                    .width(width)
                                    .height(height)
                                    .bands(6)
                                    .mode("offset")
                                    .interpolate("basis");


                                var svg = d3.select("#chartsDiv").append("svg")
                                    .attr("width", width)
                                    .attr("height", height)
                                    .style("margin-top", marginCharts);

                                charts.push(chart);
                                svgs.push(svg);
                            }



                            d3.json("experiment-2.json", function(dataOrig) {

                                for (var dc = 0; dc < nbCharts; dc++) {
                                    (function(dc) {
                                        var data = dataOrig;
                                        var curData = data.data[dc];
                                        //console.log("for data "+curData);


                                        var offset = 0;
                                        var orig_data = curData;
                                        // var mean = curData.reduce(function(p, v) { return p + v; }, offset) / curData.length;

                                        data = curData.map(function(val, i) {
                                            return [data.year[i], val];
                                        });

                                        svgs[dc].data([data]).call(charts[dc]);

                                    })(dc);
                                }
                            });

                             // Enable bands buttons. ****** TO DO: Animate area to horizon chart better
                                        d3.selectAll("#horizon-bands button").on("click", function() {
                                            // console.log('this = ', this.className);
                                            (this.className === 'area') ? n = 1: n = 6;
                                            // console.log(this.className, n);
                                            console.log(dc);
                                             for (var dc = 0; dc < 5; dc++) {
                                            svgs[dc].call(charts[dc].duration(1000).bands(n).height(height));
                                        }
                                        });
                        }

                          
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="http://www.ivg.social-sante.gouv.fr/">&nbsp;&nbsp;</a>
    <script type="text/javascript" src="http://www.aviz.fr/wiki/pub/ape/ape.js"></script>
</body>

</html>